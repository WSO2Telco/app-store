<div fxLayout="column" fxLayoutGap="20px" class="api-app-details-component">

    <div class="intro-container">

        <div class="pull-left">
            <img [src]="apiPrefix + api?.thumbnailUri" class="api-thumb" *ngIf="api?.thumbnailUri && !api?.thumbnailUrl" />
            <img [src]="apiPrefix + api?.thumbnailUrl" class="api-thumb" *ngIf="api?.thumbnailUrl" />
            <img src="assets/images/apigate-a.png" class="api-thumb" *ngIf="!api?.thumbnailUri && !api?.thumbnailUrl" />
        </div>
        <h1>{{api?.name}} <span class="version" aria-label="API Version">{{api?.version}}</span></h1>
        <div class="status-label" [ngClass]="api?.status"><span class="status-dot"></span> <span class="status-lbl">{{api?.status}}</span></div>
    </div>

    <div class="overview">
        <store-api-overview [apiOverview]="api"></store-api-overview>
        <div class="loading-card" *ngIf="!apiFullyLoaded">
            <div class="bars nomargin">
                <div class="bar bar1 loading"></div>
                <div class="bar bar2 loading"></div>
            </div>
        </div>
    </div>
    <div class="detail-container">
        <mat-tab-group animationDuration="0ms" disableRipple>
            <mat-tab *ngIf="loggedUser != null">
                <ng-template mat-tab-label>
                    <i class="fa fa-2x fa-folder"></i> Subscriptions
                </ng-template>
                <store-api-app-subscriptions [apiTiers]="api?.tiers"></store-api-app-subscriptions>
            </mat-tab>
            <mat-tab>
                <ng-template mat-tab-label>
                    <i class="fa fa-2x fa-terminal"></i> API Console
                </ng-template>

                <ng-container *ngIf="apiFullyLoaded; else consoleNotLoaded">
                    <div class="no-key" *ngIf="!loggedUser">
                        <mat-icon>info</mat-icon>
                        You require an access token to try the API invoke. Please &nbsp;<button mat-stroked-button (click)="onLoginClick()">login</button> &nbsp;and subscribe to the API to generate an access token.
                    </div>
                    <store-api-console [apiOverview]="api"></store-api-console>
                </ng-container>

                <ng-template #consoleNotLoaded>
                    <div class="loading-card">
                        <div class="bars">
                            <div class="bar bar1 loading"></div>
                            <div class="bar bar2 loading"></div>
                            <div class="bar bar3 loading"></div>
                        </div>
                    </div>
                </ng-template>

            </mat-tab>
            <mat-tab>
                <ng-template mat-tab-label>
                    <i class="fa fa-2x fa-file"></i> Documentation
                </ng-template>
                <store-api-documentation></store-api-documentation>
            </mat-tab>
            <mat-tab>
                <ng-template mat-tab-label>
                    <i class="fa fa-2x fa-cube"></i> SDKs
                </ng-template>

                <ng-container *ngIf="loggedUser != null; else sdkNotLoggedIn">
                    <store-api-sdk></store-api-sdk>
                </ng-container>

                <ng-template #sdkNotLoggedIn>
                    Please <button mat-stroked-button (click)="onLoginClick()">login</button> to see SDK download options.
                </ng-template>
            </mat-tab>
            <mat-tab>
                <ng-template mat-tab-label>
                    <i class="fa fa-2x fa-comment"></i> Forum
                </ng-template>

                <ng-container *ngIf="loggedUser != null; else forumNotLoggedIn">

                    <mat-table #table [dataSource]="forumResult" *ngIf="forumResult?.length > 0; else forumNoContent">
                        <ng-container matColumnDef="title">
                            <mat-header-cell *matHeaderCellDef> Topic</mat-header-cell>
                            <mat-cell *matCellDef="let element">{{element.title}}</mat-cell>
                        </ng-container>

                        <ng-container matColumnDef="author">
                            <mat-header-cell *matHeaderCellDef> Author</mat-header-cell>
                            <mat-cell *matCellDef="let element">{{element.author}}</mat-cell>
                        </ng-container>

                        <ng-container matColumnDef="date">
                            <mat-header-cell *matHeaderCellDef> Date</mat-header-cell>
                            <mat-cell *matCellDef="let element">{{element.date | date: 'EEEE, MMM d yyyy'}}</mat-cell>
                        </ng-container>

                        <ng-container matColumnDef="replyCount">
                            <mat-header-cell *matHeaderCellDef> Comments</mat-header-cell>
                            <mat-cell *matCellDef="let element">{{element.replyCount}}</mat-cell>
                        </ng-container>

                        <mat-header-row *matHeaderRowDef="[ 'title', 'author', 'date', 'replyCount']"></mat-header-row>
                        <mat-row *matRowDef="let row; columns: [ 'title', 'author', 'date', 'replyCount' ];" [routerLink]="['/forum/view', row.id]"></mat-row>
                    </mat-table>

                    <ng-template #forumNoContent>
                        <h3><i class="fa fa-info-circle"></i> No Discussions Found</h3>
                        <div>
                            <p>No forum discussions have been associated with this API so far.</p>
                        </div>
                    </ng-template>
                </ng-container>
                <ng-template #forumNotLoggedIn>
                    Please <button mat-stroked-button (click)="onLoginClick()">login</button> to see related forum topics
                </ng-template>
            </mat-tab>
        </mat-tab-group>
    </div>
</div>

<div class="similar-apis" *ngIf="similarApis.length > 0">
    <h2>Similar APIs</h2>

    <div class="api-list">

        <div class="api-info" *ngFor="let simapi of similarApis" (click)="similarApiNavigate(simapi.id)">
            <div class="api-icon">
                <img [src]="apiPrefix + api?.thumbnailUri" width="100" *ngIf="api?.thumbnailUri" />
                <img src="assets/images/apigate-a.png" width="100" *ngIf="!api?.thumbnailUri" />
            </div>
            <div class="api-detail-wrap">
                <div class="name-container">{{simapi.name}}</div>
                <div class="info-container">
                    <span>Version : {{simapi.version}}</span>
                    <!-- <span >{{api.provider}}</span> -->
                    <span class="star-rating">
                        <star-rating [starType]="'svg'" [rating]="simapi.stars" [hoverEnabled]="true"></star-rating>
                    </span>
                </div>
                <div class="clearfix"></div>
            </div>
        </div>

    </div>
    <div class="clearfix"></div>
</div>